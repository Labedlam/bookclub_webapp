/*! primepersonalproject 2015-12-10 */
myApp.controller("BaseController",["$scope","$http","DataService","DataServiceReg","$mdToast","$document",function(a,b,c,d,e,f){function g(){void 0===a.dataService.userData()?a.dataService.retrieveData().then(function(){a.users=a.dataService.userData()}):a.users=a.dataService.userData()}function h(){var b=a.toastPosition;b.bottom&&l.top&&(b.top=!1),b.top&&l.bottom&&(b.bottom=!1),b.right&&l.left&&(b.left=!1),b.left&&l.right&&(b.right=!1),l=angular.extend({},b)}function i(){b({method:"GET",url:"/voting/checkuservote"}).then(function(b){a.loggedInUser=b.data,a.userVoteBookChoice=b.data[0],1==b.data[0].votePrefBook?(a.show=!1,a.showresult=!0):(a.show=!0,a.showresult=!1)})}function j(){b({method:"GET",url:"/voting/haveallvotesbeencast"}).then(function(b){console.log("this is the response from the get call to the votesforbook collection",b.data[0].votesCastForBook),a.numberOfMembers=b.data[0].bookclubMembers.length,a.numberOfVotes=b.data[0].votesCastForBook.length,a.numberOfVotesLeft=a.numberOfMembers-a.numberOfVotes,a.numberOfVotes==a.numberOfMembers?(console.log("all have voted"),a.showresult=!1,a.showWinner=!0):console.log("not all users have voted"),k(b.data[0].votesCastForBook)})}function k(a){counter={},a.forEach(function(a){var b=JSON.stringify(a);counter[b]=(counter[b]||0)+1}),console.log("here is counterkey",counter)}a.dataService=c,a.users=[],a.member={},a.prefBook={},a.bookclubUsers=[],a.loggedInUser={},a.loggedInBookClub={},a.usersInBookClub=[],a.show=!0,a.showResult=!1,a.showWinner=!1,a.userVoteBookChoice=[],a.bookmodel={},a.numberOfMembers=0,a.numberOfVotes=0,a.numberOfVotesLeft=0,g(),i(),j(),a.dataService1=d,a.bookclub=[],a.infobookclub={},void 0===a.dataService1.bookclubData()?(a.dataService1.retrieveData().then(function(){a.bookclub=a.dataService1.bookclubData()}),console.log("Base Async: for book promise",a.dataService1.bookclubData())):a.bookclub=a.dataService1.bookclubData();var l={bottom:!1,top:!1,left:!0,right:!1};a.toastPosition=angular.extend({},l),a.getToastPosition=function(){return h(),Object.keys(a.toastPosition).filter(function(b){return a.toastPosition[b]}).join(" ")},a.showActionToast=function(b,c){var d=e.simple().content("Are You Sure You Want To Vote For this Book?").action("ok").highlightAction(!0).parent(f[0].querySelector("#toastBounds")).hideDelay(1e5).position(a.getToastPosition());e.show(d).then(function(d){"ok"==d&&(a.selectedIndex=c,a.userHasVoted(),a.votedBook(b),a.castPrefBookVote(b),i(),a.userVoteBookChoice=b[0],j())})},a.closeToast=function(){e.hide()},a.userHasVoted=function(){b({method:"PUT",url:"/voting/loggedin",data:{votePrefBook:"true"}}).then(function(b){a.prefBookVote=b.data})},a.votedBook=function(c){var d={title:c[0].title,author:c[0].author,summary:c[0].summary};b({method:"PUT",url:"/voting/uservotedbook",data:d}).then(function(b){console.log("here is the response from uservotedbook ",b.data),a.userVoteBookChoice=b.data})},a.castPrefBookVote=function(c){var d={title:c[0].title,author:c[0].author,summary:c[0].summary,_id:c[0]._id};b({method:"PUT",url:"/voting/updatebook",data:d}).then(function(b){a.usersInBookClub=b})}}]);